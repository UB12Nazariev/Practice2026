<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StaffFlow | Система онбординга сотрудников</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        /* Дополнительные стили для таблицы и настроек */
        .table-container {
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid var(--border);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }
        th, td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        th {
            background: #f9fafb;
            font-weight: 600;
            color: var(--text-light);
            font-size: 0.875rem;
        }
        tr:hover {
            background: #f9fafb;
        }
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 6px;
        }
        .status-dot.success { background: var(--success); }
        .status-dot.pending { background: var(--warning); }
        .status-dot.error { background: var(--danger); }

        .settings-grid {
            display: grid;
            gap: 1.5rem;
        }
        .setting-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid var(--border);
        }
        .connection-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-radius: 8px;
            background: #f8fafc;
            margin-bottom: 8px;
        }
        .connection-status.ok { border-left: 4px solid var(--success); }
        .connection-status.fail { border-left: 4px solid var(--danger); }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 1rem 0;
            align-items: center;
        }
    </style>
</head>
<body>
<!--авторизация-->
<!--<div id="login-screen" class="login-screen hidden">-->
<!--    <form id="loginForm" class="login-form">-->
<!--        <h2>Вход</h2>-->

<!--        <input id="login-username" placeholder="Логин" required />-->
<!--        <input id="login-password" type="password" placeholder="Пароль" required />-->

<!--        <button type="submit">Войти</button>-->
<!--        <div id="login-error" class="error"></div>-->
<!--    </form>-->
<!--</div>-->

<div id="login-screen" class="login-screen hidden">
    <div class="login-card">
        <h2>StaffFlow</h2>

        <form id="loginForm">
            <input
                id="login-username"
                type="text"
                placeholder="Логин"
                required
            />
            <input
                id="login-password"
                type="password"
                placeholder="Пароль"
                required
            />
            <button type="submit">Войти</button>
        </form>

        <div id="login-error" class="login-error"></div>
    </div>
</div>


<!--    <div id="app-root">-->
    <aside class="sidebar">
        <div class="brand">
            <i data-lucide="users"></i>
            <span>StaffFlow</span>
            <div class="status-indicator" title="Система активна"></div>
        </div>

        <nav class="nav-group">
            <div class="nav-link active" data-tab="registration">
                <i data-lucide="user-plus"></i>
                <span>Регистрация</span>
            </div>
            <div class="nav-link" data-tab="database">
                <i data-lucide="database"></i>
                <span>База сотрудников</span>
            </div>
            <div class="nav-link" data-tab="mail">
                <i data-lucide="mail"></i>
                <span>Почтовые ящики</span>
            </div>
            <div class="nav-link" data-tab="bitwarden">
                <i data-lucide="key"></i>
                <span>Bitwarden</span>
            </div>
            <div class="nav-link" data-tab="settings">
                <i data-lucide="settings"></i>
                <span>Настройки</span>
            </div>
        </nav>

        <div class="sidebar-footer">
            <div class="system-info">
                <small>Система онбординга</small>
                <span class="version">v1.0.0</span>
            </div>
        </div>
    </aside>

    <main class="content">
        <div class="tab-content active" id="registration-tab">
            <div class="page-header">
                <div>
                    <h1><i data-lucide="user-plus" class="header-icon"></i>Регистрация нового сотрудника</h1>
                    <p class="subtitle">Создание учетных записей во всех корпоративных системах</p>
                </div>
                <div class="header-actions">
                    <div class="status-badge">
                        <i data-lucide="circle" class="status-online"></i>
                        <span>Системы доступны</span>
                    </div>
                </div>
            </div>

            <div class="card-grid">
                <div class="card main-form">
                    <div class="card-header">
                        <h2><i data-lucide="user"></i>Основные данные</h2>
                    </div>
                    <form id="regForm">
                        <div class="form-section">
                            <h3>Персональная информация</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="lastName">
                                        <i data-lucide="user"></i>
                                        Фамилия *
                                    </label>
                                    <input type="text" id="lastName" placeholder="Иванов" required>
                                </div>
                                <div class="form-group">
                                    <label for="firstName">
                                        <i data-lucide="user"></i>
                                        Имя *
                                    </label>
                                    <input type="text" id="firstName" placeholder="Иван" required>
                                </div>
                                <div class="form-group">
                                    <label for="middleName">
                                        <i data-lucide="user"></i>
                                        Отчество
                                    </label>
                                    <input type="text" id="middleName" placeholder="Иванович">
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Служебная информация</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="position">
                                        <i data-lucide="briefcase"></i>
                                        Должность *
                                    </label>
                                    <select id="position" required>
                                        <option value="">Выберите должность...</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Системные учетные записи</h3>

                            <div class="preview-card">
                                <div class="preview-header">
                                    <i data-lucide="eye"></i>
                                    <span>Предварительный просмотр</span>
                                </div>
                                <div class="preview-grid">
                                    <div class="preview-item">
                                        <small><i data-lucide="user"></i> Логин AD</small>
                                        <p id="preview-login">-</p>
                                    </div>
                                    <div class="preview-item">
                                        <small><i data-lucide="mail"></i> Корпоративная почта</small>
                                        <p id="preview-email">-</p>
                                    </div>
                                    <div class="preview-item">
                                        <small><i data-lucide="key"></i> Временный пароль</small>
                                        <p id="preview-password">••••••••</p>
                                        <button type="button" class="btn-small" onclick="generatePassword()">
                                            <i data-lucide="refresh-cw"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="systems-grid">
                                <div class="system-toggle">
                                    <input type="checkbox" id="adRequired" checked>
                                    <label for="adRequired">
                                        <div class="system-icon ad">
                                            <i data-lucide="shield"></i>
                                        </div>
                                        <div class="system-info">
                                            <span class="system-name">Active Directory</span>
                                            <small>Корпоративная аутентификация</small>
                                        </div>
                                    </label>
                                </div>

                                <div class="system-toggle">
                                    <input type="checkbox" id="mailRequired" checked>
                                    <label for="mailRequired">
                                        <div class="system-icon mail">
                                            <i data-lucide="mail"></i>
                                        </div>
                                        <div class="system-info">
                                            <span class="system-name">Mail.ru для бизнеса</span>
                                            <small>Корпоративная почта</small>
                                        </div>
                                    </label>
                                </div>

                                <div class="system-toggle">
                                    <input type="checkbox" id="bitwardenRequired" checked>
                                    <label for="bitwardenRequired">
                                        <div class="system-icon bitwarden">
                                            <i data-lucide="key"></i>
                                        </div>
                                        <div class="system-info">
                                            <span class="system-name">BitWarden</span>
                                            <small>Менеджер паролей</small>
                                        </div>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn-secondary" onclick="clearForm()">
                                <i data-lucide="x"></i>
                                Очистить форму
                            </button>
                            <button type="submit" class="btn-primary">
                                <i data-lucide="user-plus"></i>
                                Создать все учетные записи
                                <i data-lucide="chevron-right" class="btn-icon-right"></i>
                            </button>
                        </div>
                    </form>
                </div>

                <div class="card sidebar-info">
                    <div class="card-header">
                        <h2><i data-lucide="info"></i>Информация</h2>
                    </div>

                    <div class="info-section">
                        <h3><i data-lucide="zap"></i>Что будет создано</h3>
                        <ul class="info-list">
                            <li><i data-lucide="check-circle"></i>Учетная запись в AD</li>
                            <li><i data-lucide="check-circle"></i>Почтовый ящик на Mail.ru</li>
                            <li><i data-lucide="check-circle"></i>Запись в BitWarden</li>
                            <li><i data-lucide="check-circle"></i>Запись в базе данных</li>
                        </ul>
                    </div>

                    <div class="info-section">
                        <h3><i data-lucide="clock"></i>Статистика</h3>
                        <div class="stats">
                            <div class="stat-item">
                                <span class="stat-value" id="users-today">0</span>
                                <small>сегодня</small>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value" id="users-week">0</span>
                                <small>за неделю</small>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value" id="users-total">0</span>
                                <small>всего</small>
                            </div>
                        </div>
                    </div>

                    <div class="info-section">
                        <h3><i data-lucide="alert-circle"></i>Быстрые действия</h3>
                        <button type="button" class="btn-outline full-width" onclick="openMailForm()">
                            <i data-lucide="mail-plus"></i>
                            Только почтовый ящик
                        </button>
                        <button type="button" class="btn-outline full-width mt-1" onclick="testConnections()">
                            <i data-lucide="wifi"></i>
                            Проверить подключения
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="database-tab">
            <div class="page-header">
                <div>
                    <h1><i data-lucide="database" class="header-icon"></i>База сотрудников</h1>
                    <p class="subtitle">Управление существующими учетными записями</p>
                </div>
                <div class="header-actions">
                    <button class="btn-secondary" onclick="loadEmployeesTable(1)">
                        <i data-lucide="refresh-cw"></i> Обновить
                    </button>
                </div>
            </div>

            <div class="card">
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ФИО</th>
                                <th>Логин</th>
                                <th>Email</th>
                                <th>Должность</th>
                                <th>Отдел</th>
                                <th>Статусы</th>
                                <th>Дата</th>
                            </tr>
                        </thead>
                        <tbody id="employees-table-body">
                            <tr>
                                <td colspan="7" class="text-center">Загрузка данных...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="pagination" id="pagination-controls">
                    </div>
            </div>
        </div>

        <div class="tab-content" id="mail-tab">
            <div class="page-header">
                <div>
                    <h1><i data-lucide="mail-plus" class="header-icon"></i>Добавление в Mail.ru</h1>
                    <p class="subtitle">Создание почтовых ящиков для существующих сотрудников</p>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2><i data-lucide="user-search"></i>Поиск сотрудника</h2>
                </div>
                <div class="form-section">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="searchEmployee">
                                <i data-lucide="search"></i>
                                Поиск по имени или логину
                            </label>
                            <input type="text" id="searchEmployee" placeholder="Введите фамилию или логин...">
                        </div>
                        <button type="button" class="btn-secondary" onclick="searchEmployee()">
                            <i data-lucide="search"></i>
                            Найти
                        </button>
                    </div>
                </div>

                <div class="employee-list" id="employeeList">
                    </div>

                <div class="form-section">
                    <h3>Или создайте новый почтовый ящик</h3>
                    <form id="mailForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="mailLastName">Фамилия *</label>
                                <input type="text" id="mailLastName" required>
                            </div>
                            <div class="form-group">
                                <label for="mailFirstName">Имя *</label>
                                <input type="text" id="mailFirstName" required>
                            </div>
                            <div class="form-group">
                                <label for="mailLogin">Логин (для почты) *</label>
                                <input type="text" id="mailLogin" required>
                                <small class="hint">Будет использован для email</small>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="mailPassword">Пароль *</label>
                                <div class="password-input">
                                    <input type="password" id="mailPassword" required>
                                    <button type="button" class="btn-password-toggle" onclick="togglePassword('mailPassword')">
                                        <i data-lucide="eye"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="mailDomain">Домен *</label>
                                <select id="mailDomain" required>
                                    <option value="company.ru">oknoritet.ru</option>
                                    <option value="corp.ru">corp.ru</option>
                                    <option value="office.ru">office.ru</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn-secondary" onclick="resetMailForm()">
                                <i data-lucide="rotate-ccw"></i>
                                Сбросить
                            </button>
                            <button type="submit" class="btn-primary">
                                <i data-lucide="mail-plus"></i>
                                Создать почтовый ящик
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="tab-content" id="settings-tab">
            <div class="page-header">
                <div>
                    <h1><i data-lucide="settings" class="header-icon"></i>Настройки системы</h1>
                    <p class="subtitle">Конфигурация подключений и параметры интерфейса</p>
                </div>
            </div>

            <div class="settings-grid">
                <div class="setting-card">
                    <h3><i data-lucide="activity"></i> Состояние сервисов</h3>
                    <p class="mb-4 text-gray-600">Текущий статус подключения к внешним системам.</p>

                    <div id="connection-statuses">
                        <div class="text-center text-gray-600">Нажмите "Проверить" для обновления статусов</div>
                    </div>

                    <button class="btn-primary mt-4" onclick="checkAllConnections()">
                        <i data-lucide="refresh-cw"></i> Проверить подключения
                    </button>
                </div>

                <div class="setting-card">
                    <h3><i data-lucide="server"></i> Текущая конфигурация</h3>
                    <p class="mb-4 text-gray-600">Параметры, загруженные из переменных окружения (.env).</p>

                    <div class="form-row">
                        <div class="form-group">
                            <label>AD Domain</label>
                            <input type="text" id="conf-ad-domain" readonly value="Загрузка...">
                        </div>
                        <div class="form-group">
                            <label>Mail Domain</label>
                            <input type="text" id="conf-mail-domain" readonly value="Загрузка...">
                        </div>
                        <div class="form-group">
                            <label>DB Host</label>
                            <input type="text" id="conf-db-host" readonly value="Загрузка...">
                        </div>
                    </div>
                </div>

                <div class="setting-card">
                    <h3><i data-lucide="monitor"></i> Интерфейс</h3>
                    <div class="form-group" style="max-width: 300px;">
                        <label>Строк в таблице сотрудников</label>
                        <select id="setting-rows-per-page" onchange="saveFrontendSettings()">
                            <option value="10">10 строк</option>
                            <option value="20">20 строк</option>
                            <option value="50">50 строк</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="bitwarden-tab">
            <div class="page-header">
                <div>
                    <h1>
                        <i data-lucide="key" class="header-icon"></i>
                        Bitwarden
                    </h1>
                    <p class="subtitle">
                        Ручное тестирование создания логинов в Bitwarden
                    </p>
                </div>
            </div>

            <div class="card" style="max-width: 800px;">
                <div class="card-header">
                    <h2>
                        <i data-lucide="plus-circle"></i>
                        Создание логина
                    </h2>
                </div>

                <form id="bitwardenForm">
                    <div class="form-section">

                        <div class="form-row">
                            <div class="form-group">
                                <label>Название</label>
                                <!-- Изменяем id с bwName на bw-name -->
                                <input type="text" id="bw-name" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Username</label>
                                <!-- Изменяем id с bwUsername на bw-username -->
                                <input type="text" id="bw-username" required>
                            </div>
                            <div class="form-group">
                                <label>Password</label>
                                <!-- Изменяем id с bwPassword на bw-password -->
                                <input type="text" id="bw-password" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Notes</label>
                                <!-- Изменяем id с bwNotes на bw-notes -->
                                <textarea id="bw-notes" rows="3"></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <!-- Изменяем id кнопки и добавляем правильный тип -->
                        <button type="button" class="btn-primary" id="bitwarden-submit-btn">
                            <i data-lucide="key"></i>
                            Создать в Bitwarden
                        </button>
                    </div>
                </form>
            </div>
        </div>


        <div class="modal" id="resultModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3><i data-lucide="check-circle"></i>Операция завершена</h3>
                    <button class="modal-close" onclick="closeModal()">
                        <i data-lucide="x"></i>
                    </button>
                </div>
                <div class="modal-body" id="modalContent">
                    </div>
                <div class="modal-footer">
                    <button class="btn-primary" onclick="closeModal()">Понятно</button>
                </div>
            </div>
        </div>
    </main>

    <script src="/static/script.js"></script>
<!--</div>-->
</body>
</html>